---
import Avatar from '../../components/Avatar.astro';
---

<header id="main-header">
  <div>
    <a href=`${Astro.url.origin}` class="homepage-link">
      <Avatar size="small" />
      <span>Pawe≈Ç Mrowiec</span>
    </a>
  </div>

  <nav id="main-nav">
    <a href=`#introduction` data-section-id="introduction-section">Introduction</a>
    <a href=`#projects` data-section-id="projects-section">Projects</a>
    <a href=`#articles` data-section-id="articles-section">Articles</a>
    <a href=`#contact` data-section-id="contact-section">Contact</a>
  </nav>

  <div class="links">links</div>
</header>

<style>
  header {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    padding: var(--default-layout-padding);
    position: sticky;
    top: 0;
    background: white;
    box-shadow: 0px -25px 10px 20px rgba(0, 0, 0, 0.5);

    & .homepage-link {
      text-decoration: none;
      color: black;
      display: flex;
      align-items: center;
      font-weight: 500;
      font-size: 1.5rem;
      gap: 0.6rem;
    }

    & nav {
      margin: auto;

      & a {
        text-decoration: none;
        color: #000;
        padding: 0.5rem;

        &:hover {
          text-decoration: underline;
        }
      }
    }

    .links {
      margin: auto 0;
      text-align: right;
    }
  }
</style>

<script>
  const mainNavLinks = document.querySelectorAll<HTMLAnchorElement>('#main-nav a[data-section-id]');
  const mainHeader = document.querySelector<HTMLHtmlElement>('#main-header');
  const sectionScrollOffset = 10;

  if (!mainHeader) {
    throw Error('Unable to find main header element.');
  }

  for (const link of mainNavLinks) {
    link.addEventListener('click', function onMainNavLinkClick() {
      if (!link.dataset.sectionId) {
        throw Error('Attribute [data-section-id] cannot be empty.');
      }

      const section = document.querySelector<HTMLElement>(`#${link.dataset.sectionId}`);

      if (!section) {
        throw new Error(`Section with id "${link.dataset.sectionId}" doesn't exist.`);
      }

      // TODO Integrate with sentry or something

      window.scrollTo({
        top: section.offsetTop - mainHeader.offsetHeight - sectionScrollOffset,
        behavior: 'smooth',
      });
    });
  }
</script>
